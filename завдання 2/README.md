# Лабораторна робота №3

## Тема

Сучасний книжковий шифр на основі ключових файлів

## Мета роботи

- Реалізація сучасного варіанту книжкового шифру з використанням бітових блоків
- Вивчення механізмів індексації бітових послідовностей у ключових файлах
- Засвоєння принципів перевірки цілісності файлів через SHA-256 хешування

## Короткі теоретичні відомості

Сучасний книжковий шифр працює з бітовими послідовностями замість символів. Ключові файли розбиваються на блоки фіксованої довжини \(k\) біт, після чого будується індекс, що містить всі адреси (номер файлу, номер блоку), де зустрічається кожен можливий \(k\)-бітний блок.

При шифруванні відкритий текст також розбивається на \(k\)-бітні блоки, і для кожного блоку випадково обирається одна з адрес з індексу. Результат — послідовність адрес у форматі \([file\_id, block\_id]\).

Для забезпечення цілісності використовується SHA-256 хешування ключових файлів. При дешифруванні перевіряється, що надані файли відповідають хешам з зашифрованого повідомлення.

## Опис алгоритму

### Генерація індексу

1. Кожен ключовий файл читається як бітова послідовність (через UTF-8 кодування)
2. Файли розбиваються на блоки по \(k\) біт
3. Для кожного можливого \(k\)-бітного блоку зберігаються всі адреси \((file_id, block_id)\), де він зустрічається

### Шифрування

1. Відкритий текст конвертується в UTF-8 байти, потім у бітовий рядок
2. Бітовий рядок розбивається на блоки довжини \(k\) біт (останній блок доповнюється нулями справа)
3. Для кожного блоку:
   - Шукається відповідний індекс адрес
   - Випадково обирається одна адреса з індексу
   - Адреса додається до результату
4. Зберігається початкова довжина бітового потоку (для коректного видалення padding)
5. Результат: JSON з масивом адрес, параметрами та SHA-256 хешами файлів

### Дешифрування

1. Перевіряється, що SHA-256 хеші наданих ключових файлів збігаються з хешами з JSON
2. Для кожної адреси \([file\_id, block\_id]\) з JSON:
   - Витягується відповідний \(k\)-бітний блок з ключового файлу
   - Блок додається до бітового потоку
3. Бітовий потік обрізається до початкової довжини (видаляється padding)
4. Біти конвертуються назад у UTF-8 байти, потім у текст

## Структура проєкту

- `index.html` — головна сторінка з інтерфейсом для вибору файлів та введення даних
- `script.js` — логіка шифрування, дешифрування та робота з ключовими файлами
- `style.css` — стилізація інтерфейсу

## Як запустити

1. Відкрийте файл `index.html` у сучасному браузері (Chrome, Firefox, Edge)
2. Підготуйте ключові файли:
   - Варіант A: Введіть текст у поля "Файл 1 (текст)", "Файл 2 (текст)" тощо
   - Варіант B: Натисніть "Вибрати файли" і оберіть 2-5 файлів (txt, jpg, pdf тощо)
3. Встановіть параметр \(k\) (довжина блоку в бітах, за замовчуванням 8)
4. Введіть JSON-повідомлення у поле "JSON ввід"
5. Натисніть кнопку "Шифрувати" або "Дешифрувати"

**Важливо:** Для коректного дешифрування потрібні ті самі ключові файли, що використовувалися при шифруванні.

## Формати вхідних/вихідних даних

### Вхід для шифрування

```json
{
  "message": "Привіт світ!"
}
```

### Вихід після шифрування

```json
{
  "KBits": 8,
  "BitLength": 96,
  "Files": [
    {
      "Id": 1,
      "Path": "textarea-1.txt",
      "Sha256": "a1b2c3d4e5f6...",
      "BlocksCount": 1234
    },
    {
      "Id": 2,
      "Path": "textarea-2.txt",
      "Sha256": "f6e5d4c3b2a1...",
      "BlocksCount": 987
    }
  ],
  "Addresses": [
    [1, 45],
    [2, 123],
    [1, 67],
    ...
  ]
}
```

### Вхід для дешифрування

```json
{
  "KBits": 8,
  "BitLength": 96,
  "Files": [
    {
      "Id": 1,
      "Path": "textarea-1.txt",
      "Sha256": "a1b2c3d4e5f6...",
      "BlocksCount": 1234
    },
    {
      "Id": 2,
      "Path": "textarea-2.txt",
      "Sha256": "f6e5d4c3b2a1...",
      "BlocksCount": 987
    }
  ],
  "Addresses": [
    [1, 45],
    [2, 123],
    [1, 67],
    ...
  ]
}
```

### Вихід після дешифрування

```json
{
  "message": "Привіт світ!"
}
```

## Демонстраційний приклад

### Приклад шифрування

**Ключові файли:**

- Файл 1: `The quick brown fox jumps over the lazy dog. This is a test file for encryption.`
- Файл 2: `Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt.`

**Вхідний JSON:**

```json
{
  "message": "Привіт світ!"
}
```

**Вихідний JSON:**

```json
{
  "KBits": 8,
  "BitLength": 96,
  "Files": [
    {
      "Id": 1,
      "Path": "textarea-1.txt",
      "Sha256": "a1b2c3d4e5f6...",
      "BlocksCount": 1234
    },
    {
      "Id": 2,
      "Path": "textarea-2.txt",
      "Sha256": "f6e5d4c3b2a1...",
      "BlocksCount": 987
    }
  ],
  "Addresses": [
    [1, 45],
    [2, 123],
    [1, 67],
    ...
  ]
}
```

### Приклад дешифрування

**Вхідний JSON:** (скопійований результат шифрування)

**Вихідний JSON:**

```json
{
  "message": "Привіт світ!"
}
```

## Примітки / Обмеження

- Параметр \(k\) повинен бути від 1 до 32
- Мінімум 2 ключових файли, максимум 5
- Якщо блок відкритого тексту не знайдено в ключових файлах, шифрування неможливе
- Для коректного дешифрування потрібні ті самі ключові файли, що використовувалися при шифруванні
- SHA-256 хеші використовуються для перевірки цілісності файлів при дешифруванні
